<!DOCTYPE html>
<html>
<head>
    <title>URL Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</head>
<body>
    <div class="container">
        <!-- Main Content -->
        <div class="main-content">
            <h1>URL Manager</h1>
			
			
			
            
            <!-- Search Form -->
			<form action="/search" method="GET" class="search-form">
				<input type="text" name="q" placeholder="Search by title or URL..." 
					value="{{ search_query }}">
				<button type="submit">üîç Search</button>
    
				{% if is_searching %}
				<!-- Simple link to root route -->
				<a href="/" class="clear-btn">‚ùå Clear</a>
				{% endif %}
			</form>

            <!-- SEARCH INFO ADDED -->
            {% if is_searching %}
            <div class="search-info">
                <h3>Search Results for "{{ search_query }}"</h3>
                <p>Found {{ urls|length }} active URLs ‚Ä¢ {{ archived_urls|length }} archived URLs</p>
            </div>
            {% endif %}
            
            <form action="/add" method="POST">
                <input type="url" name="url" placeholder="https://example.com" required>
                
                <!-- Tag Selection -->
                <div class="tag-selection">
                    <label>Add Tags:</label>
                    <div class="tag-buttons">
                        <button type="button" class="tag-btn work" data-tag="work">Work</button>
                        <button type="button" class="tag-btn programming" data-tag="programming">Programming</button>
                        <button type="button" class="tag-btn research" data-tag="research">Research</button>
                        <button type="button" class="tag-btn personal" data-tag="personal">Personal</button>
						<button type="button" class="tag-btn news" data-tag="news">News</button>
                    </div>
                    <input type="hidden" name="tags" id="selected-tags">
                    <div id="selected-tags-display"></div>
                </div>
                
                <button type="submit">Add URL</button>
            </form>

            <!-- ACTIVE URLS SECTION - HEADING MODIFIED -->
            <div class="section active-urls">
                <h2>{% if is_searching %}üîç Active Results{% else %}‚úÖ Active URLs{% endif %}</h2>
                
                {% if urls %}
                    {% for item in urls %}
                    <div class="url-item">
                        <div class="url-title">{{ item.title }}</div>
                        <a href="{{ item.url }}" target="_blank" class="url-link">{{ item.url }}</a>
                        
                        <!-- Display tags with remove links -->
                        <div class="url-tags">
                            {% for tag in item.tags %}
                            <span class="tag-pill tag-{{ tag }}">
                                {{ tag }}
                                <!-- Use item.id instead of url_index -->
                                <a href="/remove-tag/{{ item.id }}/{{ tag }}" class="remove-tag-btn">√ó</a>
                            </span>
                            {% endfor %}
                        </div>
                        
                        <br>
                        <!-- Buttons use item.id -->
                        <form action="/delete/{{ item.id }}" method="POST" style="display: inline;">
                            <button type="submit" class="delete-btn" 
                                    onclick="return confirm('Delete this URL?')">Delete</button>
                        </form>
                        
                        <form action="/archive/{{ item.id }}" method="POST" style="display: inline;">
                            <button type="submit" class="archive-btn"
                                    onclick="return confirm('Archive this URL?')">Archive</button>
                        </form>
                        
                        <button class="copy-btn" data-url="{{ item.url }}">Copy URL</button>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>{% if is_searching %}No active URLs found for "{{ search_query }}"{% else %}No URLs added yet.{% endif %}</p>
                {% endif %}
            </div>

            <!-- ARCHIVED URLS SECTION - HEADING MODIFIED -->
            <div class="section archived-urls">
                <h2>{% if is_searching %}üîç Archived Results{% else %}üì¶ Archived URLs{% endif %}</h2>

                {% if archived_urls %}
                    {% for item in archived_urls %}
                    <div class="url-item archived">
                        <div class="url-title">{{ item.title }}</div>
                        <a href="{{ item.url }}" target="_blank" class="url-link">{{ item.url }}</a>
                        
                        <!-- Display tags (read-only for archived) -->
                        {% if item.tags %}
                        <div class="url-tags">
                            {% for tag in item.tags %}
                            <span class="tag-pill tag-{{ tag }}">
                                {{ tag }}
                            </span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <br>
                        <!-- Only Unarchive Button -->
                        <form action="/unarchive/{{ item.id }}" method="POST" style="display: inline;">
                            <button type="submit" class="unarchive-btn">Unarchive</button>
                        </form>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>{% if is_searching %}No archived URLs found for "{{ search_query }}"{% else %}No archived URLs.{% endif %}</p>
                {% endif %}
            </div>
        </div>

        <!-- Tag Sidebar -->
        <div class="tag-sidebar">
            <h3>TAGS</h3>
            <div class="tag-cloud">
                {% for tag in ['work', 'programming', 'research', 'personal','news'] %}
                    {% set tag_urls = [] %}
                    {% for url in urls %}
                        {% if tag in url.tags %}
                            {% set _ = tag_urls.append(url) %}
                        {% endif %}
                    {% endfor %}
                    
                    {% if tag_urls %}
                    <div class="tag-sidebar-item">
                        <button class="tag-sidebar-btn tag-{{ tag }}" data-tag="{{ tag }}">
                            {{ tag }} ({{ tag_urls|length }})
                        </button>
                        <div class="tag-dropdown" id="dropdown-{{ tag }}">
                            {% for url in tag_urls %}
                            <div class="dropdown-url">
                                <a href="{{ url.url }}" target="_blank">{{ url.title }}</a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</body>
</html>